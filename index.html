<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anchorite - Your Spiritual Companion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        .quick-action-btn {
            @apply px-3 py-1 text-sm bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors;
        }
        .book-card {
            @apply bg-white dark:bg-[#2d2d2d] rounded-lg shadow-md p-6 cursor-pointer transition-all duration-300 hover:scale-105 border border-gray-200 dark:border-gray-600;
        }
        #votd-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        h1, h2, h3, h4 {
            font-family: 'Playfair Display', serif;
        }
        body {
            background-color: #f8f8f8;
            color: #1a1a1a;
        }
        body.dark {
            background-color: #1a1a1a;
            color: #f8f8f8;
        }
        .prose p {
            line-height: 1.8;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }
        .verse-number {
            color: #d97706;
            font-weight: 500;
        }
        .rating-star {
            transition: all 0.2s ease;
        }
        .rating-star:hover {
            transform: scale(1.2);
        }
    </style>
</head>
<body class="transition-colors duration-300">
    <!-- Navigation -->
    <nav class="bg-white dark:bg-[#2d2d2d] shadow-sm sticky top-0 z-40 border-b border-gray-200 dark:border-gray-600">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <h1 class="text-xl font-bold text-gray-900 dark:text-[#f8f8f8]">Anchorite</h1>
                </div>
                <div class="flex space-x-4 items-center">
                    <button id="settings-btn" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                        <i class="fas fa-cog text-gray-600 dark:text-gray-300"></i>
                    </button>
                    <button id="theme-toggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                        <i class="fas fa-moon text-gray-600 dark:text-yellow-400"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
        <div class="bg-white dark:bg-[#2d2d2d] rounded-lg shadow-xl max-w-md w-full max-h-[80vh] overflow-hidden border border-gray-200 dark:border-gray-600">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-[#f8f8f8]">Settings</h3>
                    <button id="close-settings" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="p-6 overflow-y-auto">
                <div class="space-y-6">
                    <div>
                        <h4 class="font-semibold text-gray-900 dark:text-[#f8f8f8] mb-3 text-lg">Feedback</h4>
                        <div class="space-y-3">
                            <button id="rate-app-btn" class="w-full text-left p-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors flex items-center justify-between group">
                                <span class="text-gray-900 dark:text-[#f8f8f8] group-hover:text-amber-500">Rate Anchorite</span>
                                <i class="fas fa-star text-amber-500"></i>
                            </button>
                            <button class="w-full text-left p-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors flex items-center justify-between group">
                                <span class="text-gray-900 dark:text-[#f8f8f8] group-hover:text-blue-500">Share Feedback</span>
                                <i class="fas fa-comment text-blue-500"></i>
                            </button>
                            <div class="flex items-center justify-between p-3">
                                <span class="text-gray-900 dark:text-[#f8f8f8]">Rating Prompts</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="rating-prompts-toggle" class="sr-only peer" checked>
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-amber-500"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Rating Modal -->
    <div id="rating-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
        <div class="bg-white dark:bg-[#2d2d2d] rounded-lg shadow-xl max-w-md w-full border border-gray-200 dark:border-gray-600 transform transition-all duration-300 scale-95 opacity-0">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-[#f8f8f8]">Rate Our Platform</h3>
                    <button id="close-rating" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <!-- Star Rating -->
                <div class="flex justify-center mb-4">
                    <div class="flex space-x-1" id="star-rating">
                        <!-- Stars will be generated here -->
                    </div>
                </div>
                
                <!-- Percentage Bar -->
                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mb-6">
                    <div id="rating-percentage" class="bg-amber-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
                
                <!-- Comment Box -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-900 dark:text-[#f8f8f8] mb-2">
                        Tell us about your experience (max 200 characters)
                    </label>
                    <textarea 
                        id="rating-comment" 
                        rows="3" 
                        maxlength="200"
                        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-[#1a1a1a] text-gray-900 dark:text-[#f8f8f8] focus:ring-2 focus:ring-amber-500 focus:border-transparent resize-none"
                        placeholder="Share your thoughts..."></textarea>
                    <div class="flex justify-between mt-1">
                        <span class="text-xs text-gray-500 dark:text-gray-400">Your feedback helps us improve</span>
                        <span id="char-count" class="text-xs text-gray-500 dark:text-gray-400">0/200</span>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="flex space-x-3">
                    <button id="submit-rating" class="flex-1 bg-amber-500 hover:bg-amber-600 text-white py-2 px-4 rounded-lg transition-colors font-medium">
                        Submit Rating
                    </button>
                    <button id="remind-later" class="flex-1 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded-lg transition-colors">
                        Remind me later
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Toast -->
    <div id="success-toast" class="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform transition-all duration-300 translate-x-full z-50">
        <div class="flex items-center space-x-2">
            <i class="fas fa-check-circle"></i>
            <span>Thank you for your feedback! üôè</span>
        </div>
    </div>

    <!-- Main App Container -->
    <div class="max-w-4xl mx-auto py-8 px-4">
        <!-- Library Section -->
        <section id="library-section" class="mb-12">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-[#f8f8f8]">Your Library</h2>
                <button id="explore-books-btn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2">
                    <i class="fas fa-plus"></i>
                    <span>Explore More Books</span>
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- All 5 Default Books -->
                <div class="book-card border-l-4 border-blue-500" data-book="genesis">
                    <h3 class="font-semibold text-gray-900 dark:text-[#f8f8f8]">Genesis</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">The Book of Beginnings</p>
                    <div class="mt-3 flex justify-between items-center">
                        <span class="text-xs text-gray-500 dark:text-gray-400">50 chapters</span>
                        <span class="text-xs bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-2 py-1 rounded">Installed</span>
                    </div>
                </div>
                <div class="book-card border-l-4 border-green-500" data-book="psalms">
                    <h3 class="font-semibold text-gray-900 dark:text-[#f8f8f8]">Psalms</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">Book of Worship & Emotion</p>
                    <div class="mt-3 flex justify-between items-center">
                        <span class="text-xs text-gray-500 dark:text-gray-400">150 chapters</span>
                        <span class="text-xs bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-2 py-1 rounded">Installed</span>
                    </div>
                </div>
                <div class="book-card border-l-4 border-purple-500" data-book="isaiah">
                    <h3 class="font-semibold text-gray-900 dark:text-[#f8f8f8]">Isaiah</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">Book of Redemption & Hope</p>
                    <div class="mt-3 flex justify-between items-center">
                        <span class="text-xs text-gray-500 dark:text-gray-400">66 chapters</span>
                        <span class="text-xs bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-2 py-1 rounded">Installed</span>
                    </div>
                </div>
                <div class="book-card border-l-4 border-orange-500" data-book="luke">
                    <h3 class="font-semibold text-gray-900 dark:text-[#f8f8f8]">Luke</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">The Compassionate Christ</p>
                    <div class="mt-3 flex justify-between items-center">
                        <span class="text-xs text-gray-500 dark:text-gray-400">24 chapters</span>
                        <span class="text-xs bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-2 py-1 rounded">Installed</span>
                    </div>
                </div>
                <div class="book-card border-l-4 border-red-500" data-book="ephesians">
                    <h3 class="font-semibold text-gray-900 dark:text-[#f8f8f8]">Ephesians</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">Identity & Purpose in Christ</p>
                    <div class="mt-3 flex justify-between items-center">
                        <span class="text-xs text-gray-500 dark:text-gray-400">6 chapters</span>
                        <span class="text-xs bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-2 py-1 rounded">Installed</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Books Modal -->
        <div id="books-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
            <div class="bg-white dark:bg-[#2d2d2d] rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-hidden border border-gray-200 dark:border-gray-600">
                <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                    <div class="flex justify-between items-center">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-[#f8f8f8]">Add Books to Your Library</h3>
                        <button id="close-modal" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-xl">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <input type="text" id="book-search" placeholder="Search books..." class="w-full mt-4 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-[#1a1a1a] text-gray-900 dark:text-[#f8f8f8] focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div class="p-6 overflow-y-auto max-h-[60vh]">
                    <div class="space-y-6">
                        <div>
                            <h4 class="font-semibold text-gray-900 dark:text-[#f8f8f8] mb-3 text-lg border-b border-gray-200 dark:border-gray-700 pb-2">Gospels</h4>
                            <div class="grid grid-cols-1 gap-3">
                                <div class="flex justify-between items-center p-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                                    <div>
                                        <span class="text-gray-900 dark:text-[#f8f8f8] font-medium">Matthew</span>
                                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">The King and His Kingdom</p>
                                    </div>
                                    <button class="install-book-btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded text-sm transition-colors" data-book="matthew">Install</button>
                                </div>
                                <div class="flex justify-between items-center p-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                                    <div>
                                        <span class="text-gray-900 dark:text-[#f8f8f8] font-medium">Mark</span>
                                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">The Servant and His Service</p>
                                    </div>
                                    <button class="install-book-btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded text-sm transition-colors" data-book="mark">Install</button>
                                </div>
                                <div class="flex justify-between items-center p-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                                    <div>
                                        <span class="text-gray-900 dark:text-[#f8f8f8] font-medium">John</span>
                                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">The Son of God and Eternal Life</p>
                                    </div>
                                    <button class="install-book-btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded text-sm transition-colors" data-book="john">Install</button>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-900 dark:text-[#f8f8f8] mb-3 text-lg border-b border-gray-200 dark:border-gray-700 pb-2">Letters</h4>
                            <div class="grid grid-cols-1 gap-3">
                                <div class="flex justify-between items-center p-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                                    <div>
                                        <span class="text-gray-900 dark:text-[#f8f8f8] font-medium">Romans</span>
                                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">The Righteousness of God</p>
                                    </div>
                                    <button class="install-book-btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded text-sm transition-colors" data-book="romans">Install</button>
                                </div>
                                <div class="flex justify-between items-center p-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                                    <div>
                                        <span class="text-gray-900 dark:text-[#f8f8f8] font-medium">1 Corinthians</span>
                                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Order in the Church</p>
                                    </div>
                                    <button class="install-book-btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded text-sm transition-colors" data-book="1corinthians">Install</button>
                                </div>
                                <div class="flex justify-between items-center p-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                                    <div>
                                        <span class="text-gray-900 dark:text-[#f8f8f8] font-medium">Revelation</span>
                                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">The Unveiling of Jesus Christ</p>
                                    </div>
                                    <button class="install-book-btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded text-sm transition-colors" data-book="revelation">Install</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reader Section -->
        <section id="reader-section" class="mb-12">
            <div class="bg-white dark:bg-[#2d2d2d] rounded-lg shadow-lg p-6 border border-gray-200 dark:border-gray-600">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4">
                    <div class="flex items-center space-x-4">
                        <h3 id="current-book" class="text-lg font-semibold text-gray-900 dark:text-[#f8f8f8]">Genesis 1:1-3</h3>
                        <div class="flex space-x-2">
                            <button id="prev-chapter" class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 px-3 py-1 rounded transition-colors">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button id="next-chapter" class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 px-3 py-1 rounded transition-colors">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    <button id="explain-btn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2">
                        <i class="fas fa-lightbulb"></i>
                        <span>Explain This</span>
                    </button>
                </div>
                <div id="bible-content" class="prose dark:prose-invert max-w-none max-h-96 overflow-y-auto">
                    <!-- Bible content will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Koinonia Chat Section -->
        <section id="chat-section">
            <div class="bg-white dark:bg-[#2d2d2d] rounded-lg shadow-lg border border-gray-200 dark:border-gray-600">
                <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-[#f8f8f8]">
                        <i class="fas fa-robot text-blue-500 mr-2"></i>
                        Koinonia
                    </h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Your spiritual companion</p>
                </div>
                
                <div id="chat-messages" class="h-96 overflow-y-auto p-4 space-y-4">
                    <!-- Chat messages will appear here -->
                </div>
                
                <div class="p-4 border-t border-gray-200 dark:border-gray-700">
                    <div class="flex space-x-2">
                        <input type="text" id="message-input" 
                               placeholder="Ask Koinonia for guidance..." 
                               class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-[#1a1a1a] text-gray-900 dark:text-[#f8f8f8]">
                        <button id="send-button" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-colors">
                            Send
                        </button>
                    </div>
                    <div class="flex flex-wrap gap-2 mt-2">
                        <button class="quick-action-btn" data-prompt="prayer">üôè Prayer</button>
                        <button class="quick-action-btn" data-prompt="joke">üòÑ Joke</button>
                        <button class="quick-action-btn" data-prompt="affirmation">‚öì Truth</button>
                        <button class="quick-action-btn" data-prompt="healing">‚ù§Ô∏è Healing Prayer</button>
                        <button class="quick-action-btn" data-prompt="salvation">‚úùÔ∏è Salvation</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Verse of the Day Section -->
        <section id="votd-section" class="mt-12 p-6 rounded-lg shadow-lg text-white border border-gray-200 dark:border-gray-600">
            <h3 class="text-lg font-semibold mb-2">Verse of the Day</h3>
            <p id="votd-text" class="text-xl italic mb-2">"For I know the plans I have for you, declares the Lord, plans for welfare and not for evil, to give you a future and a hope."</p>
            <p id="votd-ref" class="text-sm opacity-90">- Jeremiah 29:11</p>
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mt-4 gap-4">
                <button id="share-verse" class="bg-white text-blue-600 px-4 py-2 rounded-lg font-semibold hover:bg-blue-50 transition-colors flex items-center space-x-2">
                    <i class="fas fa-share-alt"></i>
                    <span>Share</span>
                </button>
            </div>
        </section>
    </div>

    <script>
        // App State
        let currentBook = 'genesis';
        let currentChapter = 1;
        let studySessionCount = 0;
        let chatInteractionCount = 0;
        let lastRatingPrompt = null;
        let ratingPromptsEnabled = true;
        
        // Initialize app state from localStorage
        function initializeAppState() {
            const savedState = localStorage.getItem('anchorite_app_state');
            if (savedState) {
                const state = JSON.parse(savedState);
                studySessionCount = state.studySessionCount || 0;
                chatInteractionCount = state.chatInteractionCount || 0;
                lastRatingPrompt = state.lastRatingPrompt || null;
                ratingPromptsEnabled = state.ratingPromptsEnabled !== false;
            }
            
            // Update toggle in settings
            document.getElementById('rating-prompts-toggle').checked = ratingPromptsEnabled;
        }
        
        // Save app state to localStorage
        function saveAppState() {
            const state = {
                studySessionCount,
                chatInteractionCount,
                lastRatingPrompt,
                ratingPromptsEnabled
            };
            localStorage.setItem('anchorite_app_state', JSON.stringify(state));
        }
        
        // Track study session
        function trackStudySession() {
            if (!ratingPromptsEnabled) return;
            
            studySessionCount++;
            saveAppState();
            
            // Check if we should show rating prompt
            if (studySessionCount === 3 || chatInteractionCount === 5) {
                const now = new Date().getTime();
                const oneWeekAgo = now - (7 * 24 * 60 * 60 * 1000);
                
                if (!lastRatingPrompt || lastRatingPrompt < oneWeekAgo) {
                    setTimeout(() => {
                        showRatingModal();
                    }, 1000);
                }
            }
        }
        
        // Track chat interaction
        function trackChatInteraction() {
            if (!ratingPromptsEnabled) return;
            
            chatInteractionCount++;
            saveAppState();
            
            // Check if we should show rating prompt
            if (studySessionCount === 3 || chatInteractionCount === 5) {
                const now = new Date().getTime();
                const oneWeekAgo = now - (7 * 24 * 60 * 60 * 1000);
                
                if (!lastRatingPrompt || lastRatingPrompt < oneWeekAgo) {
                    setTimeout(() => {
                        showRatingModal();
                    }, 1000);
                }
            }
        }

        // Bible content database (simplified for demo)
        const bibleContent = {
            genesis: {
                1: {
                    verses: [
                        "In the beginning God created the heaven and the earth.",
                        "And the earth was without form, and void; and darkness was upon the face of the deep. And the Spirit of God moved upon the face of the waters.",
                        "And God said, Let there be light: and there was light.",
                        "And God saw the light, that it was good: and God divided the light from the darkness.",
                        "And God called the light Day, and the darkness he called Night. And the evening and the morning were the first day.",
                        "And God said, Let there be a firmament in the midst of the waters, and let it divide the waters from the waters.",
                        "And God made the firmament, and divided the waters which were under the firmament from the waters which were above the firmament: and it was so.",
                        "And God called the firmament Heaven. And the evening and the morning were the second day.",
                        "And God said, Let the waters under the heaven be gathered together unto one place, and let the dry land appear: and it was so.",
                        "And God called the dry land Earth; and the gathering together of the waters called he Seas: and God saw that it was good."
                    ]
                },
                2: {
                    verses: [
                        "Thus the heavens and the earth were finished, and all the host of them.",
                        "And on the seventh day God ended his work which he had made; and he rested on the seventh day from all his work which he had made.",
                        "And God blessed the seventh day, and sanctified it: because that in it he had rested from all his work which God created and made.",
                        "These are the generations of the heavens and of the earth when they were created, in the day that the Lord God made the earth and the heavens,",
                        "And every plant of the field before it was in the earth, and every herb of the field before it grew: for the Lord God had not caused it to rain upon the earth, and there was not a man to till the ground.",
                        "But there went up a mist from the earth, and watered the whole face of the ground.",
                        "And the Lord God formed man of the dust of the ground, and breathed into his nostrils the breath of life; and man became a living soul."
                    ]
                }
            },
            psalms: {
                1: {
                    verses: [
                        "Blessed is the man that walketh not in the counsel of the ungodly, nor standeth in the way of sinners, nor sitteth in the seat of the scornful.",
                        "But his delight is in the law of the Lord; and in his law doth he meditate day and night.",
                        "And he shall be like a tree planted by the rivers of water, that bringeth forth his fruit in his season; his leaf also shall not wither; and whatsoever he doeth shall prosper.",
                        "The ungodly are not so: but are like the chaff which the wind driveth away.",
                        "Therefore the ungodly shall not stand in the judgment, nor sinners in the congregation of the righteous.",
                        "For the Lord knoweth the way of the righteous: but the way of the ungodly shall perish."
                    ]
                },
                23: {
                    verses: [
                        "The Lord is my shepherd; I shall not want.",
                        "He maketh me to lie down in green pastures: he leadeth me beside the still waters.",
                        "He restoreth my soul: he leadeth me in the paths of righteousness for his name's sake.",
                        "Yea, though I walk through the valley of the shadow of death, I will fear no evil: for thou art with me; thy rod and thy staff they comfort me.",
                        "Thou preparest a table before me in the presence of mine enemies: thou anointest my head with oil; my cup runneth over.",
                        "Surely goodness and mercy shall follow me all the days of my life: and I will dwell in the house of the Lord for ever."
                    ]
                }
            }
        };

        // Book names mapping
        const bookNames = {
            genesis: "Genesis",
            psalms: "Psalms", 
            isaiah: "Isaiah",
            luke: "Luke",
            ephesians: "Ephesians",
            matthew: "Matthew",
            mark: "Mark",
            john: "John",
            romans: "Romans",
            "1corinthians": "1 Corinthians",
            revelation: "Revelation"
        };

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            initializeAppState();
            initializeRatingSystem();
            setRandomVOTD();
            loadBibleContent(currentBook, currentChapter);
            
            // Track initial study session
            trackStudySession();
        });

        // Rating System
        function initializeRatingSystem() {
            // Create star rating UI
            const starContainer = document.getElementById('star-rating');
            for (let i = 1; i <= 5; i++) {
                const star = document.createElement('div');
                star.className = 'rating-star cursor-pointer text-2xl text-gray-300 dark:text-gray-600';
                star.innerHTML = '‚òÖ';
                star.dataset.rating = i;
                star.addEventListener('click', handleStarClick);
                star.addEventListener('mouseenter', handleStarHover);
                starContainer.appendChild(star);
            }

            // Character counter
            const commentBox = document.getElementById('rating-comment');
            const charCount = document.getElementById('char-count');
            commentBox.addEventListener('input', function() {
                const length = this.value.length;
                charCount.textContent = `${length}/200`;
                if (length > 200) {
                    charCount.classList.add('text-red-500');
                } else {
                    charCount.classList.remove('text-red-500');
                }
            });

            // Rating modal events
            document.getElementById('close-rating').addEventListener('click', closeRatingModal);
            document.getElementById('submit-rating').addEventListener('click', submitRating);
            document.getElementById('remind-later').addEventListener('click', remindLater);
            
            // Settings events
            document.getElementById('settings-btn').addEventListener('click', openSettings);
            document.getElementById('close-settings').addEventListener('click', closeSettings);
            document.getElementById('rate-app-btn').addEventListener('click', function() {
                closeSettings();
                setTimeout(() => showRatingModal(), 300);
            });
            
            // Rating prompts toggle
            document.getElementById('rating-prompts-toggle').addEventListener('change', function() {
                ratingPromptsEnabled = this.checked;
                saveAppState();
            });
        }

        let currentRating = 0;
        let hoverRating = 0;

        function handleStarClick(e) {
            currentRating = parseInt(e.target.dataset.rating);
            updateStarDisplay();
            updatePercentageBar();
        }

        function handleStarHover(e) {
            hoverRating = parseInt(e.target.dataset.rating);
            updateStarDisplay();
        }

        function updateStarDisplay() {
            const stars = document.querySelectorAll('#star-rating .rating-star');
            const ratingToShow = hoverRating || currentRating;
            
            stars.forEach((star, index) => {
                const starValue = index + 1;
                if (starValue <= ratingToShow) {
                    star.style.color = '#f59e0b'; // amber-500
                } else {
                    star.style.color = '#d1d5db'; // gray-300
                }
            });
        }

        function updatePercentageBar() {
            const percentage = (currentRating / 5) * 100;
            document.getElementById('rating-percentage').style.width = `${percentage}%`;
        }

        function showRatingModal() {
            const modal = document.getElementById('rating-modal');
            modal.classList.remove('hidden');
            
            // Reset form
            currentRating = 0;
            hoverRating = 0;
            document.getElementById('rating-comment').value = '';
            document.getElementById('char-count').textContent = '0/200';
            document.getElementById('char-count').classList.remove('text-red-500');
            document.getElementById('rating-percentage').style.width = '0%';
            
            // Reset stars
            const stars = document.querySelectorAll('#star-rating .rating-star');
            stars.forEach(star => {
                star.style.color = '#d1d5db';
            });
            
            // Animate in
            setTimeout(() => {
                modal.querySelector('.transform').classList.remove('scale-95', 'opacity-0');
                modal.querySelector('.transform').classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function closeRatingModal() {
            const modal = document.getElementById('rating-modal');
            modal.querySelector('.transform').classList.remove('scale-100', 'opacity-100');
            modal.querySelector('.transform').classList.add('scale-95', 'opacity-0');
            
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        function submitRating() {
            if (currentRating === 0) {
                alert('Please select a rating before submitting.');
                return;
            }

            // Save rating (in a real app, this would send to a server)
            const comment = document.getElementById('rating-comment').value;
            const ratingData = {
                rating: currentRating,
                comment: comment,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('anchorite_rating', JSON.stringify(ratingData));
            lastRatingPrompt = new Date().getTime();
            saveAppState();
            
            // Reset counters
            studySessionCount = 0;
            chatInteractionCount = 0;
            saveAppState();
            
            closeRatingModal();
            showSuccessToast();
        }

        function remindLater() {
            lastRatingPrompt = new Date().getTime();
            saveAppState();
            closeRatingModal();
        }

        function showSuccessToast() {
            const toast = document.getElementById('success-toast');
            toast.classList.remove('translate-x-full');
            
            setTimeout(() => {
                toast.classList.add('translate-x-full');
            }, 3000);
        }

        function openSettings() {
            document.getElementById('settings-modal').classList.remove('hidden');
        }

        function closeSettings() {
            document.getElementById('settings-modal').classList.add('hidden');
        }

        // [Rest of your existing code for Bible content, chat, etc. remains the same]
        // ... (I've included the essential parts, but you'd want to keep all your existing functionality)

    </script>
</body>
</html>
