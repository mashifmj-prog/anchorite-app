<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anchorite - Your Spiritual Companion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        .quick-action-btn {
            @apply px-3 py-1 text-sm bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors;
        }
        .book-card {
            @apply bg-white dark:bg-[#2d2d2d] rounded-lg shadow-md p-6 cursor-pointer transition-all duration-300 hover:scale-105 border border-gray-200 dark:border-gray-600;
        }
        #votd-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        h1, h2, h3, h4 {
            font-family: 'Playfair Display', serif;
        }
        body {
            background-color: #f8f8f8;
            color: #1a1a1a;
        }
        body.dark {
            background-color: #1a1a1a;
            color: #f8f8f8;
        }
        .bible-text {
            line-height: 1.8;
            font-size: 1.1rem;
            color: #1a1a1a;
        }
        .dark .bible-text {
            color: #f8f8f8;
        }
        .verse-number {
            color: #d97706;
            font-weight: 500;
            margin-right: 0.5rem;
        }
        .rating-star {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .rating-star:hover {
            transform: scale(1.2);
        }
        .chapter-container {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 1rem;
        }
        .chapter-container::-webkit-scrollbar {
            width: 6px;
        }
        .chapter-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .dark .chapter-container::-webkit-scrollbar-track {
            background: #2d2d2d;
        }
        .chapter-container::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }
        .dark .chapter-container::-webkit-scrollbar-thumb {
            background: #555;
        }
    </style>
</head>
<body class="transition-colors duration-300">
    <!-- Navigation -->
    <nav class="bg-white dark:bg-[#2d2d2d] shadow-sm sticky top-0 z-40 border-b border-gray-200 dark:border-gray-600">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <h1 class="text-xl font-bold text-gray-900 dark:text-[#f8f8f8]">Anchorite</h1>
                </div>
                <div class="flex space-x-4 items-center">
                    <button id="theme-toggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                        <i class="fas fa-moon text-gray-600 dark:text-yellow-400"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Rating Modal -->
    <div id="rating-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
        <div class="bg-white dark:bg-[#2d2d2d] rounded-lg shadow-xl max-w-md w-full border border-gray-200 dark:border-gray-600 transform transition-all duration-300 scale-95 opacity-0">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-[#f8f8f8]">Rate Our Platform</h3>
                    <button id="close-rating" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <!-- Star Rating -->
                <div class="flex justify-center mb-2 space-x-1" id="star-rating">
                    <!-- Stars will be generated here -->
                </div>
                
                <!-- Percentage Labels -->
                <div class="flex justify-between mb-4 px-2">
                    <span class="text-xs text-gray-600 dark:text-gray-400">20</span>
                    <span class="text-xs text-gray-600 dark:text-gray-400">40</span>
                    <span class="text-xs text-gray-600 dark:text-gray-400">60</span>
                    <span class="text-xs text-gray-600 dark:text-gray-400">80</span>
                    <span class="text-xs text-gray-600 dark:text-gray-400">100</span>
                </div>
                
                <!-- Total Percentage -->
                <div class="text-center mb-6">
                    <span id="total-percentage" class="text-lg font-semibold text-amber-600 dark:text-amber-400">Total: 0%</span>
                </div>
                
                <!-- Action Buttons -->
                <div class="flex space-x-3">
                    <button id="submit-rating" class="flex-1 bg-amber-500 hover:bg-amber-600 text-white py-3 px-4 rounded-lg transition-colors font-medium">
                        Submit Rating
                    </button>
                </div>

                <!-- Submission Status -->
                <div id="submit-status" class="text-center mt-4 hidden">
                    <span id="status-text" class="text-green-600 dark:text-green-400 font-medium"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div class="max-w-4xl mx-auto py-8 px-4">
        <!-- Library Section -->
        <section id="library-section" class="mb-12">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-[#f8f8f8]">Your Library</h2>
                <button id="explore-books-btn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2">
                    <i class="fas fa-plus"></i>
                    <span>Explore More Books</span>
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="library-grid">
                <!-- Books will be dynamically loaded here -->
            </div>
        </section>

        <!-- Books Modal -->
        <div id="books-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
            <div class="bg-white dark:bg-[#2d2d2d] rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-hidden border border-gray-200 dark:border-gray-600">
                <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                    <div class="flex justify-between items-center">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-[#f8f8f8]">Add Books to Your Library</h3>
                        <button id="close-modal" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-xl">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <input type="text" id="book-search" placeholder="Search books..." class="w-full mt-4 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-[#1a1a1a] text-gray-900 dark:text-[#f8f8f8] focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div class="p-6 overflow-y-auto max-h-[60vh]">
                    <div class="space-y-6" id="available-books">
                        <!-- Available books will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Reader Section -->
        <section id="reader-section" class="mb-12">
            <div class="bg-white dark:bg-[#2d2d2d] rounded-lg shadow-lg p-6 border border-gray-200 dark:border-gray-600">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4">
                    <div class="flex items-center space-x-4">
                        <h3 id="current-book" class="text-lg font-semibold text-gray-900 dark:text-[#f8f8f8]">Genesis 1</h3>
                        <div class="flex space-x-2">
                            <button id="prev-chapter" class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 px-3 py-1 rounded transition-colors">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button id="next-chapter" class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 px-3 py-1 rounded transition-colors">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    <button id="explain-btn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2">
                        <i class="fas fa-lightbulb"></i>
                        <span>Explain This</span>
                    </button>
                </div>
                <div class="chapter-container">
                    <div id="bible-content" class="bible-text">
                        <!-- Bible content will be loaded here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Koinonia Chat Section -->
        <section id="chat-section">
            <div class="bg-white dark:bg-[#2d2d2d] rounded-lg shadow-lg border border-gray-200 dark:border-gray-600">
                <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-[#f8f8f8]">
                        <i class="fas fa-robot text-blue-500 mr-2"></i>
                        Koinonia
                    </h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Your spiritual companion</p>
                </div>
                
                <div id="chat-messages" class="h-96 overflow-y-auto p-4 space-y-4">
                    <!-- Chat messages will appear here -->
                </div>
                
                <div class="p-4 border-t border-gray-200 dark:border-gray-700">
                    <div class="flex space-x-2">
                        <input type="text" id="message-input" 
                               placeholder="Ask Koinonia for guidance..." 
                               class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-[#1a1a1a] text-gray-900 dark:text-[#f8f8f8]">
                        <button id="send-button" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-colors">
                            Send
                        </button>
                    </div>
                    <div class="flex flex-wrap gap-2 mt-2">
                        <button class="quick-action-btn" data-prompt="prayer">🙏 Prayer</button>
                        <button class="quick-action-btn" data-prompt="joke">😄 Joke</button>
                        <button class="quick-action-btn" data-prompt="affirmation">⚓ Truth</button>
                        <button class="quick-action-btn" data-prompt="healing">❤️ Healing Prayer</button>
                        <button class="quick-action-btn" data-prompt="salvation">✝️ Salvation</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Verse of the Day Section -->
        <section id="votd-section" class="mt-12 p-6 rounded-lg shadow-lg text-white border border-gray-200 dark:border-gray-600">
            <h3 class="text-lg font-semibold mb-2">Verse of the Day</h3>
            <p id="votd-text" class="text-xl italic mb-2">"For I know the plans I have for you, declares the Lord, plans for welfare and not for evil, to give you a future and a hope."</p>
            <p id="votd-ref" class="text-sm opacity-90">- Jeremiah 29:11</p>
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mt-4 gap-4">
                <button id="share-verse" class="bg-white text-blue-600 px-4 py-2 rounded-lg font-semibold hover:bg-blue-50 transition-colors flex items-center space-x-2">
                    <i class="fas fa-share-alt"></i>
                    <span>Share</span>
                </button>
            </div>
        </section>

        <!-- Rate App Button at Bottom -->
        <div class="mt-12 text-center">
            <button id="rate-app-bottom" class="bg-amber-500 hover:bg-amber-600 text-white px-6 py-3 rounded-lg transition-colors font-medium flex items-center space-x-2 mx-auto">
                <i class="fas fa-star"></i>
                <span>Rate App</span>
            </button>
        </div>
    </div>

    <script>
        // App State
        let currentBook = 'genesis';
        let currentChapter = 1;
        let userLibrary = ['genesis', 'psalms', 'isaiah', 'luke', 'ephesians'];
        let availableBooks = {
            'matthew': { name: 'Matthew', description: 'The King and His Kingdom', category: 'Gospels' },
            'mark': { name: 'Mark', description: 'The Servant and His Service', category: 'Gospels' },
            'john': { name: 'John', description: 'The Son of God and Eternal Life', category: 'Gospels' },
            'romans': { name: 'Romans', description: 'The Righteousness of God', category: 'Letters' },
            '1corinthians': { name: '1 Corinthians', description: 'Order in the Church', category: 'Letters' },
            'revelation': { name: 'Revelation', description: 'The Unveiling of Jesus Christ', category: 'Letters' }
        };

        // Bible content database
        const bibleContent = {
            genesis: {
                1: `
                    <p><span class="verse-number">1</span>In the beginning God created the heaven and the earth.</p>
                    <p><span class="verse-number">2</span>And the earth was without form, and void; and darkness was upon the face of the deep. And the Spirit of God moved upon the face of the waters.</p>
                    <p><span class="verse-number">3</span>And God said, Let there be light: and there was light.</p>
                    <p><span class="verse-number">4</span>And God saw the light, that it was good: and God divided the light from the darkness.</p>
                    <p><span class="verse-number">5</span>And God called the light Day, and the darkness he called Night. And the evening and the morning were the first day.</p>
                    <p><span class="verse-number">6</span>And God said, Let there be a firmament in the midst of the waters, and let it divide the waters from the waters.</p>
                    <p><span class="verse-number">7</span>And God made the firmament, and divided the waters which were under the firmament from the waters which were above the firmament: and it was so.</p>
                    <p><span class="verse-number">8</span>And God called the firmament Heaven. And the evening and the morning were the second day.</p>
                    <p><span class="verse-number">9</span>And God said, Let the waters under the heaven be gathered together unto one place, and let the dry land appear: and it was so.</p>
                    <p><span class="verse-number">10</span>And God called the dry land Earth; and the gathering together of the waters called he Seas: and God saw that it was good.</p>
                `,
                2: `
                    <p><span class="verse-number">1</span>Thus the heavens and the earth were finished, and all the host of them.</p>
                    <p><span class="verse-number">2</span>And on the seventh day God ended his work which he had made; and he rested on the seventh day from all his work which he had made.</p>
                    <p><span class="verse-number">3</span>And God blessed the seventh day, and sanctified it: because that in it he had rested from all his work which God created and made.</p>
                `
            },
            psalms: {
                1: `
                    <p><span class="verse-number">1</span>Blessed is the man that walketh not in the counsel of the ungodly, nor standeth in the way of sinners, nor sitteth in the seat of the scornful.</p>
                    <p><span class="verse-number">2</span>But his delight is in the law of the Lord; and in his law doth he meditate day and night.</p>
                    <p><span class="verse-number">3</span>And he shall be like a tree planted by the rivers of water, that bringeth forth his fruit in his season; his leaf also shall not wither; and whatsoever he doeth shall prosper.</p>
                `,
                23: `
                    <p><span class="verse-number">1</span>The Lord is my shepherd; I shall not want.</p>
                    <p><span class="verse-number">2</span>He maketh me to lie down in green pastures: he leadeth me beside the still waters.</p>
                    <p><span class="verse-number">3</span>He restoreth my soul: he leadeth me in the paths of righteousness for his name's sake.</p>
                `
            }
        };

        // Book names mapping
        const bookNames = {
            genesis: "Genesis",
            psalms: "Psalms", 
            isaiah: "Isaiah",
            luke: "Luke",
            ephesians: "Ephesians",
            matthew: "Matthew",
            mark: "Mark",
            john: "John",
            romans: "Romans",
            "1corinthians": "1 Corinthians",
            revelation: "Revelation"
        };

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            initializeDarkMode();
            initializeLibrary();
            initializeBooksModal();
            initializeRatingSystem();
            initializeChat();
            setRandomVOTD();
            loadBibleContent(currentBook, currentChapter);
        }

        // Dark Mode Toggle - FIXED
        function initializeDarkMode() {
            const toggleButton = document.getElementById('theme-toggle');
            const savedTheme = localStorage.getItem('theme');
            const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            // Set initial theme
            if (savedTheme === 'dark' || (!savedTheme && systemPrefersDark)) {
                document.documentElement.classList.add('dark');
                toggleButton.querySelector('i').className = 'fas fa-sun text-yellow-400';
            } else {
                document.documentElement.classList.remove('dark');
                toggleButton.querySelector('i').className = 'fas fa-moon text-gray-600';
            }
            
            // Toggle functionality
            toggleButton.addEventListener('click', function() {
                const isDark = document.documentElement.classList.toggle('dark');
                const icon = this.querySelector('i');
                
                if (isDark) {
                    icon.className = 'fas fa-sun text-yellow-400';
                    localStorage.setItem('theme', 'dark');
                } else {
                    icon.className = 'fas fa-moon text-gray-600';
                    localStorage.setItem('theme', 'light');
                }
            });
        }

        // Library Management - FIXED
        function initializeLibrary() {
            renderLibrary();
            
            // Make library books clickable
            document.addEventListener('click', function(e) {
                const bookCard = e.target.closest('.book-card');
                if (bookCard) {
                    const bookId = bookCard.dataset.book;
                    currentBook = bookId;
                    currentChapter = 1;
                    loadBibleContent(bookId, 1);
                }
            });

            // Chapter navigation
            document.getElementById('prev-chapter').addEventListener('click', function() {
                if (currentChapter > 1) {
                    currentChapter--;
                    loadBibleContent(currentBook, currentChapter);
                }
            });

            document.getElementById('next-chapter').addEventListener('click', function() {
                if (bibleContent[currentBook] && bibleContent[currentBook][currentChapter + 1]) {
                    currentChapter++;
                    loadBibleContent(currentBook, currentChapter);
                }
            });
        }

        function renderLibrary() {
            const libraryGrid = document.getElementById('library-grid');
            libraryGrid.innerHTML = '';
            
            userLibrary.forEach(bookId => {
                const book = availableBooks[bookId] || { 
                    name: bookNames[bookId], 
                    description: 'Book of the Bible',
                    category: 'Default'
                };
                
                const bookCard = document.createElement('div');
                bookCard.className = 'book-card border-l-4 border-blue-500';
                bookCard.dataset.book = bookId;
                bookCard.innerHTML = `
                    <h3 class="font-semibold text-gray-900 dark:text-[#f8f8f8]">${book.name}</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">${book.description}</p>
                    <div class="mt-3 flex justify-between items-center">
                        <span class="text-xs text-gray-500 dark:text-gray-400">${getChapterCount(bookId)} chapters</span>
                        <span class="text-xs bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-2 py-1 rounded">Installed</span>
                    </div>
                `;
                libraryGrid.appendChild(bookCard);
            });
        }

        function getChapterCount(bookId) {
            const counts = {
                genesis: 50, psalms: 150, isaiah: 66, luke: 24, ephesians: 6,
                matthew: 28, mark: 16, john: 21, romans: 16, '1corinthians': 16, revelation: 22
            };
            return counts[bookId] || '?';
        }

        // Books Modal - FIXED
        function initializeBooksModal() {
            const exploreBtn = document.getElementById('explore-books-btn');
            const booksModal = document.getElementById('books-modal');
            const closeModal = document.getElementById('close-modal');

            exploreBtn.addEventListener('click', function() {
                renderAvailableBooks();
                booksModal.classList.remove('hidden');
            });

            closeModal.addEventListener('click', function() {
                booksModal.classList.add('hidden');
            });

            booksModal.addEventListener('click', function(e) {
                if (e.target === booksModal) {
                    booksModal.classList.add('hidden');
                }
            });

            // Book search
            document.getElementById('book-search').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const bookItems = document.querySelectorAll('.available-book-item');
                
                bookItems.forEach(item => {
                    const bookName = item.querySelector('span').textContent.toLowerCase();
                    if (bookName.includes(searchTerm) || searchTerm === '') {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
        }

        function renderAvailableBooks() {
            const availableBooksContainer = document.getElementById('available-books');
            availableBooksContainer.innerHTML = '';
            
            const categories = {};
            Object.entries(availableBooks).forEach(([bookId, book]) => {
                if (!userLibrary.includes(bookId)) {
                    if (!categories[book.category]) categories[book.category] = [];
                    categories[book.category].push({ id: bookId, ...book });
                }
            });

            Object.entries(categories).forEach(([category, books]) => {
                const categorySection = document.createElement('div');
                categorySection.innerHTML = `
                    <h4 class="font-semibold text-gray-900 dark:text-[#f8f8f8] mb-3 text-lg border-b border-gray-200 dark:border-gray-700 pb-2">${category}</h4>
                    <div class="grid grid-cols-1 gap-3" id="books-${category}"></div>
                `;
                availableBooksContainer.appendChild(categorySection);
                
                const booksContainer = document.getElementById(`books-${category}`);
                books.forEach(book => {
                    const bookItem = document.createElement('div');
                    bookItem.className = 'available-book-item flex justify-between items-center p-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors';
                    bookItem.innerHTML = `
                        <div>
                            <span class="text-gray-900 dark:text-[#f8f8f8] font-medium">${book.name}</span>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">${book.description}</p>
                        </div>
                        <button class="install-book-btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded text-sm transition-colors" data-book="${book.id}">
                            Install
                        </button>
                    `;
                    booksContainer.appendChild(bookItem);
                });
            });

            // Add install button event listeners
            document.querySelectorAll('.install-book-btn').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const bookId = this.dataset.book;
                    installBook(bookId);
                });
            });
        }

        function installBook(bookId) {
            if (!userLibrary.includes(bookId)) {
                userLibrary.push(bookId);
                renderLibrary();
                document.getElementById('books-modal').classList.add('hidden');
                
                // Show success message
                addMessage(`I've installed ${availableBooks[bookId].name} to your library!`, true);
                setTimeout(() => {
                    addMessage(`Wonderful! ${availableBooks[bookId].name} is now available in your library. You can click on it to start reading.`);
                }, 1000);
            }
        }

        // Bible Content Loading
        function loadBibleContent(book, chapter) {
            const content = bibleContent[book]?.[chapter];
            const bookName = bookNames[book];
            
            document.getElementById('current-book').textContent = `${bookName} ${chapter}`;
            
            const bibleContentEl = document.getElementById('bible-content');
            if (content) {
                bibleContentEl.innerHTML = content;
            } else {
                bibleContentEl.innerHTML = '<p class="text-gray-700 dark:text-gray-300">Content not available in this demo.</p>';
            }
            
            // Update chapter navigation
            updateChapterNavigation(book, chapter);
        }

        function updateChapterNavigation(book, chapter) {
            const prevBtn = document.getElementById('prev-chapter');
            const nextBtn = document.getElementById('next-chapter');
            
            prevBtn.disabled = chapter <= 1;
            nextBtn.disabled = !bibleContent[book]?.[chapter + 1];
        }

        // Rating System - FIXED
        function initializeRatingSystem() {
            // Create star rating UI
            const starContainer = document.getElementById('star-rating');
            for (let i = 1; i <= 5; i++) {
                const star = document.createElement('div');
                star.className = 'rating-star text-3xl text-gray-300 dark:text-gray-600';
                star.innerHTML = '★';
                star.dataset.rating = i;
                star.dataset.percentage = i * 20;
                star.addEventListener('click', handleStarClick);
                star.addEventListener('mouseenter', handleStarHover);
                starContainer.appendChild(star);
            }

            // Rating modal events
            document.getElementById('close-rating').addEventListener('click', closeRatingModal);
            document.getElementById('submit-rating').addEventListener('click', submitRating);
            document.getElementById('rate-app-bottom').addEventListener('click', showRatingModal);
            
            // Reset stars when mouse leaves container
            starContainer.addEventListener('mouseleave', function() {
                updateStarDisplay(currentRating);
            });
        }

        let currentRating = 0;

        function handleStarClick(e) {
            currentRating = parseInt(e.target.dataset.rating);
            updateStarDisplay(currentRating);
            updateTotalPercentage();
        }

        function handleStarHover(e) {
            const hoverRating = parseInt(e.target.dataset.rating);
            updateStarDisplay(hoverRating);
        }

        function updateStarDisplay(rating) {
            const stars = document.querySelectorAll('#star-rating .rating-star');
            stars.forEach((star, index) => {
                const starValue = index + 1;
                if (starValue <= rating) {
                    star.style.color = '#f59e0b'; // amber-500
                } else {
                    star.style.color = '#d1d5db'; // gray-300
                }
            });
        }

        function updateTotalPercentage() {
            const percentage = currentRating * 20;
            document.getElementById('total-percentage').textContent = `Total: ${percentage}%`;
        }

        function showRatingModal() {
            const modal = document.getElementById('rating-modal');
            modal.classList.remove('hidden');
            
            // Reset form
            currentRating = 0;
            document.getElementById('total-percentage').textContent = 'Total: 0%';
            document.getElementById('submit-status').classList.add('hidden');
            
            // Reset stars
            updateStarDisplay(0);
            
            // Animate in
            setTimeout(() => {
                modal.querySelector('.transform').classList.remove('scale-95', 'opacity-0');
                modal.querySelector('.transform').classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function closeRatingModal() {
            const modal = document.getElementById('rating-modal');
            modal.querySelector('.transform').classList.remove('scale-100', 'opacity-100');
            modal.querySelector('.transform').classList.add('scale-95', 'opacity-0');
            
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        function submitRating() {
            if (currentRating === 0) {
                alert('Please select a rating before submitting.');
                return;
            }

            const statusElement = document.getElementById('submit-status');
            const statusText = document.getElementById('status-text');
            
            // Show "Submitted"
            statusElement.classList.remove('hidden');
            statusText.textContent = 'Submitted';
            
            // After 3 seconds, show "Thank you"
            setTimeout(() => {
                statusText.textContent = 'Thank you';
                
                // Close modal after another 2 seconds
                setTimeout(() => {
                    closeRatingModal();
                }, 2000);
            }, 3000);
        }

        // Chat System
        function initializeChat() {
            // Koinonia's introduction
            setTimeout(() => {
                addMessage("Peace be with you! I'm Koinonia, your spiritual companion. I'm here to walk with you through Scripture, offer guidance in prayer, and provide a listening ear for your heart's journey. Whether you're seeking wisdom, comfort, or deeper understanding, I'm here to help.");
            }, 1000);

            // Send button event
            document.getElementById('send-button').addEventListener('click', sendMessage);
            
            // Enter key to send
            document.getElementById('message-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            // Quick action buttons
            document.querySelectorAll('.quick-action-btn').forEach(button => {
                button.addEventListener('click', function(e) {
                    const promptType = e.target.dataset.prompt;
                    handleQuickAction(promptType);
                });
            });

            // Explain button
            document.getElementById('explain-btn').addEventListener('click', function() {
                const bookName = bookNames[currentBook];
                addMessage(`Can you explain ${bookName} ${currentChapter}?`, true);
                setTimeout(() => {
                    addMessage(`This passage from ${bookName} reveals profound truths about God's character and His relationship with humanity. The language and context provide deep spiritual insights that can guide our understanding of faith and practice.`);
                }, 1000);
            });
        }

        function addMessage(text, isUser = false) {
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${isUser ? 'justify-end' : 'justify-start'}`;
            
            const bubble = document.createElement('div');
            bubble.className = `max-w-xs lg:max-w-md px-4 py-2 rounded-2xl ${
                isUser 
                    ? 'bg-blue-500 text-white rounded-br-none' 
                    : 'bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-white rounded-bl-none'
            }`;
            bubble.textContent = text;
            
            messageDiv.appendChild(bubble);
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function sendMessage() {
            const messageInput = document.getElementById('message-input');
            const message = messageInput.value.trim();
            
            if (message) {
                addMessage(message, true);
                messageInput.value = '';
                
                // Simulate AI response
                setTimeout(() => {
                    let response = "I hear your heart. In the full version, I'd provide thoughtful, biblically-grounded guidance tailored to your situation.";
                    
                    // Simple keyword responses
                    const lowerMessage = message.toLowerCase();
                    if (lowerMessage.includes('hello') || lowerMessage.includes('hi')) {
                        response = "Greetings! How can I support your spiritual journey today?";
                    } else if (lowerMessage.includes('pray')) {
                        response = "Prayer is a beautiful conversation with God. Would you like me to pray with you, or are you seeking guidance on how to pray?";
                    } else if (lowerMessage.includes('thank')) {
                        response = "You're most welcome! It's a joy to walk alongside you in your spiritual journey.";
                    }
                    
                    addMessage(response);
                }, 1000);
            }
        }

        function handleQuickAction(promptType) {
            let response = "";
            switch(promptType) {
                case 'prayer':
                    response = "Heavenly Father, we come before You with open hearts. Guide us, comfort us, and reveal Your will in our lives. In Jesus' name, Amen.";
                    break;
                case 'joke':
                    response = "Why did the coffee file a police report? It got mugged! 😊";
                    break;
                case 'affirmation':
                    response = "You are deeply loved by God, exactly as you are today. (John 3:16)";
                    break;
                case 'healing':
                    response = "Lord Jesus, You are the Great Physician. We ask for Your healing touch and comforting presence. Bring wholeness and peace. Amen.";
                    break;
                case 'salvation':
                    response = "Salvation is God's free gift! If you're ready: 'Jesus, I believe You died for me. Come into my heart and save me.' Then find a Bible-believing church!";
                    break;
            }
            addMessage(response);
        }

        // Verse of the Day
        function setRandomVOTD() {
            const votdVerses = [
                { text: "For I know the plans I have for you, declares the Lord, plans for welfare and not for evil, to give you a future and a hope.", reference: "Jeremiah 29:11" },
                { text: "I can do all things through him who strengthens me.", reference: "Philippians 4:13" },
                { text: "The Lord is my shepherd; I shall not want.", reference: "Psalm 23:1" }
            ];
            
            const randomIndex = Math.floor(Math.random() * votdVerses.length);
            const votd = votdVerses[randomIndex];
            document.getElementById('votd-text').textContent = `"${votd.text}"`;
            document.getElementById('votd-ref').textContent = `- ${votd.reference}`;
        }

        // Share functionality
        document.getElementById('share-verse').addEventListener('click', function() {
            const votdText = document.getElementById('votd-text').textContent;
            const votdRef = document.getElementById('votd-ref').textContent;
            
            const shareText = `${votdText} ${votdRef}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Verse of the Day',
                    text: shareText
                });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('Verse copied to clipboard!');
                });
            }
        });
    </script>
</body>
</html>
